<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes de Infraestructura - Ciudad del Este</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin="">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

</head>
<body>
    <!-- Navegaci√É¬≥n -->
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">√∞≈∏¬è‚Äî√Ø¬∏¬è REPORTES CIUDADANOS</h1>
            <div class="nav-links">
                <button class="nav-btn active" onclick="mostrarSeccion('lista')">Reportes</button>
                <button class="nav-btn" onclick="mostrarSeccion('crear')">Crear Reporte</button>
                {% if rol == 'admin' %}
                <button class="nav-btn" onclick="mostrarSeccion('analiticas')">Anal√É¬≠ticas</button>
                {% endif %}
                <a href="/logout" class="nav-btn">Cerrar sesi√É¬≥n</a>
            </div>
        </div>
    </nav>

    <!-- Contenedor principal -->
    <div class="container main-content">

        <!-- Secci√≥n: Crear Reporte -->
        <section id="seccion-crear" class="seccion">
            <h2>Crear Nuevo Reporte</h2>
            <p class="descripcion">Reporta baches y problemas de infraestructura en tu comunidad</p>

            <form id="form-crear-reporte" class="form-card">
                <div class="form-group">
                    <label>√∞≈∏‚Äú¬ç Ubicaci√É¬≥n en el mapa *</label>

                    <div id="map" style="height: 300px; border-radius: 8px;"></div>

                    <input type="hidden" id="lat" name="lat" required>
                    <input type="hidden" id="lng" name="lng" required>

                    <small>Toca el mapa para marcar la ubicaci√≥n exacta</small>
                </div>

                <div class="form-group">
                    <label for="categoria">üè∑Ô∏è Categor√≠a *</label>
                    <select id="categoria" name="categoria" required>
                        <option value="V√≠as y Tr√°nsito">V√≠as y Tr√°nsito</option>
                        <option value="Alumbrado P√∫blico">Alumbrado P√∫blico</option>
                        <option value="Agua y Saneamiento">Agua y Saneamiento</option>
                        <option value="Residuos y Limpieza">Residuos y Limpieza</option>
                        <option value="Parques y Espacios P√∫blicos">Parques y Espacios P√∫blicos</option>
                        <option value="Electricidad y Telecomunicaciones">Electricidad y Telecomunicaciones</option>
                        <option value="Edificaciones P√∫blicas">Edificaciones P√∫blicas</option>
                        <option value="Seguridad Urbana">Seguridad Urbana</option>
                        <option value="Transporte P√∫blico">Transporte P√∫blico</option>
                        <option value="Otros">Otros</option>
                    </select>
                    <small>Selecciona la categor√≠a m√°s apropiada</small>
                </div>


                <div class="form-group">
                    <label for="comentario">√∞≈∏‚Äô¬¨ Descripci√É¬≥n del Problema *</label>
                    <textarea
                        id="comentario"
                        name="comentario"
                        rows="4"
                        placeholder="Describe el problema: tama√É¬±o, ubicaci√É¬≥n exacta, peligrosidad, etc."
                        required
                    ></textarea>
                    <small>M√É¬≠nimo 10 caracteres</small>
                </div>

                <div class="form-group">
                    <label for="foto">√∞≈∏‚Äú¬∑ Foto del Problema *</label>
                    <input
                        type="file"
                        id="foto"
                        name="foto"
                        accept="image/*"
                        capture="environment"
                        required
                    >

                    <small>Formatos: JPG, PNG, WEBP - M√É¬°ximo 5MB</small>
                </div>

                <div class="form-group">
                    <label for="email">√∞≈∏‚Äú¬ß Email (Opcional)</label>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        placeholder="tu@email.com"
                    >
                    <small>Para recibir notificaciones sobre tu reporte</small>
                </div>

                <button type="submit" class="btn btn-primary">Enviar Reporte</button>
            </form>

            <div id="mensaje-crear" class="mensaje oculto"></div>
        </section>

        <!-- Secci√≥n: Reportes -->
        <section id="seccion-lista" class="seccion active">
            <h2>Reportes</h2>
            <p class="descripcion">Visualiza y gestiona todos los reportes de la comunidad</p>

            <!-- Filtros -->
            <div class="filtros">
                <label for="filtro-estado">Filtrar por estado:</label>
                <select id="filtro-estado" onchange="cargarReportes()">
                    <option value="Todos">Todos</option>
                    <option value="Pendiente">Pendiente</option>
                    <option value="Verificando">Verificando</option>
                    <option value="Solucionado">Solucionado</option>
                    <option value="Rechazado">Rechazado</option>
                </select>
            </div>

            <!-- Grid de reportes -->
            <div id="lista-reportes" class="reportes-grid">
                <p class="cargando">Cargando reportes...</p>
            </div>
        </section>

        <!-- Secci√É¬≥n: Anal√É¬≠ticas (solo admin) -->
        {% if rol == 'admin' %}
        <section id="seccion-analiticas" class="seccion">
            <h2>Anal√É¬≠ticas</h2>
            <p class="descripcion">Estad√É¬≠sticas generales del sistema</p>

            <!-- Estad√É¬≠sticas en tarjetas -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="stat-total">0</h3>
                    <p>Total Reportes</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat-pendiente">0</h3>
                    <p>Pendientes</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat-verificando">0</h3>
                    <p>Verificando</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat-solucionado">0</h3>
                    <p>Solucionados</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat-rechazado">0</h3>
                    <p>Rechazados</p>
                </div>
            </div>

            <!-- Gr√É¬°fico de barras -->
            <div class="analiticas-grafico">
                <h3>Distribuci√É¬≥n por Estado</h3>
                <div class="grafico-barra">
                    <div class="barra-item">
                        <span class="barra-label">Pendiente</span>
                        <div class="barra-contenedor">
                            <div id="barra-pendiente" class="barra estado-pendiente" style="width: 0%"></div>
                        </div>
                        <span id="valor-pendiente" class="barra-valor">0</span>
                    </div>
                    <div class="barra-item">
                        <span class="barra-label">Verificando</span>
                        <div class="barra-contenedor">
                            <div id="barra-verificando" class="barra estado-verificando" style="width: 0%"></div>
                        </div>
                        <span id="valor-verificando" class="barra-valor">0</span>
                    </div>
                    <div class="barra-item">
                        <span class="barra-label">Solucionado</span>
                        <div class="barra-contenedor">
                            <div id="barra-solucionado" class="barra estado-solucionado" style="width: 0%"></div>
                        </div>
                        <span id="valor-solucionado" class="barra-valor">0</span>
                    </div>
                    <div class="barra-item">
                        <span class="barra-label">Rechazado</span>
                        <div class="barra-contenedor">
                            <div id="barra-rechazado" class="barra estado-rechazado" style="width: 0%"></div>
                        </div>
                        <span id="valor-rechazado" class="barra-valor">0</span>
                    </div>
                </div>
            </div>

            <!-- Reportes recientes -->
            <div class="analiticas-recientes">
                <h3>Reportes Recientes</h3>
                <div id="reportes-recientes" class="reportes-grid">
                    <p class="cargando">Cargando...</p>
                </div>
            </div>
        </section>
        {% endif %}

    </div>

    <!-- Modal para ver detalles de un reporte -->
    <div id="modal-reporte" class="modal oculto">
        <div class="modal-content">
            <span class="modal-close" onclick="cerrarModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>
    <script src="/static/script.js"></script>
</body>
</html>